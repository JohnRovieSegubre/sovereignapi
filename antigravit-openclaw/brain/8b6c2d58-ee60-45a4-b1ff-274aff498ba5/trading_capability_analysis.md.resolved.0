# BTC Options Bot - Trading Capability Analysis

## Executive Summary

This is a sophisticated **market-making bot** for Polymarket's BTC binary options (1-hour expiry). The bot uses a multi-layered approach combining:
- **Fair value pricing** (midpoint depth-weighted or Black-Scholes)
- **8 amplification strategies** for edge detection
- **Risk management** with position limits, trailing stops, and forced exits

**Overall Assessment: 7.5/10** - A well-architected system with good fundamentals, but some structural concerns that could impact live trading profitability.

---

## 1. Core Trading Strategy

### Market Type
- **Instrument**: Binary options on Polymarket (BTC above/below strike at expiry)
- **Timeframe**: 1-hour markets with continuous trading
- **Resolution**: Binance BTC/USDT price at market close

### Entry Logic

The bot identifies buy opportunities when:
```
Fair Value (amplified) > Best Ask + BUY_ENTRY_EDGE (default 0.75%)
```

**Key Entry Filters:**
| Filter | Description | Rating |
|--------|-------------|--------|
| Edge bounds | `BUY_ENTRY_EDGE` (0.75%) to `MAX_ENTRY_EDGE` (1.5%) | â˜…â˜…â˜…â˜…â˜† |
| Position limits | Max 40 shares per side | â˜…â˜…â˜…â˜…â˜… |
| Near-expiry guard | FV must be â‰¥40% with <15 min left | â˜…â˜…â˜…â˜…â˜† |
| OFI veto | Block if >60% order book imbalance | â˜…â˜…â˜…â˜…â˜† |
| Velocity veto | Block buying into pumps/dumps (>3%/candle) | â˜…â˜…â˜…â˜…â˜† |
| Pre-order recheck | Re-validate conditions before execution | â˜…â˜…â˜…â˜…â˜… |

### Fair Value Methods

The bot supports multiple fair value calculation methods:

1. **`midpoint_depth`** (default) - Distance-decay VWAP across top 5 levels
2. **`black_scholes`** - GBM probability model with volatility
3. **[trade_average](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/polymarket_orderbook_websocket.py#430-526)** - Recent trade SMA from WebSocket
4. **`hybrid`** - Weighted combination of BS and market-derived

> [!TIP]
> The `midpoint_depth` method is the best choice for market-making since it reflects actual market liquidity rather than theoretical pricing.

---

## 2. Amplification Strategies (Edge Detection)

The bot uses **8 amplification strategies** that modify the base fair value:

| Strategy | Purpose | Max Amp | Rating |
|----------|---------|---------|--------|
| **Momentum** | MACD, Stochastic, ROC signals | +12% | â˜…â˜…â˜…â˜…â˜† |
| **Price Velocity** | Speed & acceleration of price moves | +8% | â˜…â˜…â˜…â˜…â˜… |
| **Order Flow (Polymarket)** | Bid/ask depth imbalance | +8% | â˜…â˜…â˜…â˜†â˜† |
| **Binance OFI** | BTC order book imbalance | +8% | â˜…â˜…â˜…â˜…â˜… |
| **Volume Profile** | Volume percentile analysis | +8% | â˜…â˜…â˜…â˜†â˜† |
| **Volatility Regime** | ATR-based vol expansion/contraction | +12% | â˜…â˜…â˜…â˜†â˜† |
| **OBV Divergence** | Price-volume divergence detection | +6% | â˜…â˜…â˜…â˜…â˜† |
| **Volatility Percentile** | Regime filter (stretch vs coil) | +10% | â˜…â˜…â˜…â˜†â˜† |

### Amplification Calculation
```python
# From main_bot_optimized.py lines 2768-2774
total_amp_up = 1.0 + 2.0 * (amp_up - 1.0)      # DOUBLED deviation
total_amp_down = 1.0 + 2.0 * (amp_down - 1.0)  # DOUBLED deviation

# Apply to fair values
fv_up_amp = fair_value_up_avg * total_amp_up
fv_down_amp = fair_value_down_avg * total_amp_down
```

> [!IMPORTANT]
> The **doubling of amplification** is aggressive. A 5% signal becomes 10% effective amp. This requires high-quality signals to avoid over-trading.

### Global Caps
- **Maximum combined amp**: +30% (`AMP_GLOBAL_CAP = 1.30`)
- **Minimum floor**: -25% (`AMP_GLOBAL_FLOOR = 0.75`)

---

## 3. Exit Strategy

The bot has a well-structured **multi-tier exit system**:

### Exit Priority Order

| Priority | Strategy | Trigger | Action |
|----------|----------|---------|--------|
| 1 | **Forced Exit** | <2 min to expiry | 100% market sell |
| 2 | **Hard Stop-Loss** | P&L â‰¤ -30% | 100% market sell |
| 3 | **Time-Based Exit** | <5 min to expiry + losing | 100% market sell |
| 4 | **FV Reversion TP** | Amp collapsed to ~1.0 near FV | 50% market sell |
| 5 | **Order Book Exit** | Bid > FV | Split: 25% market + 25% limit |
| 6 | **Reversal Exit** | Switching sides | 25% of opposite position |

### Key Exit Parameters
```python
STOP_LOSS_PCT = -30%              # Hard stop-loss
TRAILING_STOP_ACTIVATION = +10%   # Activate trailing at +10%
TRAILING_STOP_DISTANCE = 5%       # Trail by 5%
TAKE_PROFIT_1 = +10%              # First TP level
TAKE_PROFIT_2 = +15%              # Second TP level
TAKE_PROFIT_3 = +20%              # Final TP level
```

---

## 4. Risk Management

### Strengths âœ…

| Feature | Implementation | Rating |
|---------|---------------|--------|
| Position limits | 40 shares per side, 100 USDC max | â˜…â˜…â˜…â˜…â˜… |
| Pre-order validation | Re-check conditions before execution | â˜…â˜…â˜…â˜…â˜… |
| Forced exit | Never let positions expire | â˜…â˜…â˜…â˜…â˜… |
| Edge bounds | Min/max edge thresholds | â˜…â˜…â˜…â˜…â˜† |
| Veto system | Block extreme market conditions | â˜…â˜…â˜…â˜…â˜† |
| Cache invalidation | Refresh positions after trades | â˜…â˜…â˜…â˜…â˜… |

### Concerns âš ï¸

| Issue | Description | Risk Level |
|-------|-------------|------------|
| No daily loss limit | `STOP_LOSS_THRESHOLD` is not actively enforced | ðŸ”´ High |
| Aggressive amplification | 2x multiplier may cause over-trading | ðŸŸ¡ Medium |
| Latency sensitivity | Multiple API calls per cycle | ðŸŸ¡ Medium |
| WebSocket dependencies | Multiple WS connections needed | ðŸŸ¡ Medium |

---

## 5. Strengths of the Bot

### 1. **Modular Architecture** â˜…â˜…â˜…â˜…â˜…
Clean separation of concerns:
- [config.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/config.py) - All parameters in one place
- [module2_market_orchestrator.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/module2_market_orchestrator.py) - Market discovery
- [module3_pricing_engine.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/module3_pricing_engine.py) - Black-Scholes pricing
- [module4_execution_engine.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/module4_execution_engine.py) - Order execution
- [amplification_strategies.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/amplification_strategies.py) - Edge detection

### 2. **Multi-Source Price Fetching** â˜…â˜…â˜…â˜…â˜…
Three fallback layers:
1. Binance WebSocket (primary, ~10ms latency)
2. Binance REST API (fallback)
3. Chainlink on-chain (emergency)

### 3. **Comprehensive Logging** â˜…â˜…â˜…â˜…â˜†
Detailed trade context logging:
```python
def log_trade_details(self, action, token_id, price, ...):
    # Logs BTC price, sigma, fair values, market info
```

### 4. **Caching Optimization** â˜…â˜…â˜…â˜…â˜…
Multiple caching layers:
- Position cache (30s TTL)
- Black-Scholes cache (1000 entries)
- Market cache (45 min TTL, aligned to hour)
- OHLCV cache (candle-aligned)

### 5. **Test Mode** â˜…â˜…â˜…â˜…â˜…
Full simulation without real trades:
```bash
python main_bot_optimized.py --test
```

---

## 6. Weaknesses & Concerns

### 1. **Over-Complexity Risk** ðŸ”´

**8 amplification strategies** is a lot. The interaction effects between strategies can be unpredictable:

```python
# From calculate_combined_amplification
amp_up *= momentum['amp_up']
amp_up *= vol_regime['amp_up']
amp_up *= orderbook['amp_up']
amp_up *= volume_profile['amp_up']
amp_up *= price_velocity['amp_up']
amp_up *= obv_div['amp_up']
amp_up *= vol_percentile['amp_up']
amp_up *= exhaustion['amp_up']
```

**Recommendation**: Backtest each strategy independently to identify which ones actually add alpha.

### 2. **Parameter Sensitivity** ðŸŸ¡

The bot has **100+ configurable parameters** in [config.py](file:///c:/Users/rovie%20segubre/btc_15min_options_bot/config.py). Key ones without obvious justification:

- `BUY_ENTRY_EDGE = 0.0075` (0.75%) - Why this specific value?
- `MAX_ENTRY_EDGE = 0.015` (1.5%) - Based on backtesting?
- `EXHAUSTION_CONFIRM_MIN_VEL_PCT = 0.10` - Empirically derived?

**Recommendation**: Document the reasoning or backtesting behind key parameters.

### 3. **Execution Quality Unknowns** ðŸŸ¡

The bot uses **FAK** (Fill-and-Kill) orders by default:
```python
ORDER_ENTRY_TIF = "FAK"  # Partial fills + cancel remainder
```

This may result in:
- Partial fills on entries (position sizing issues)
- Higher effective slippage in thin markets

**Recommendation**: Log fill rates and slippage to assess execution quality.

### 4. **Missing Daily P&L Tracking** ðŸ”´

While `STOP_LOSS_THRESHOLD = -50.0` exists in config, it's not actively enforced in the main loop:
```python
def can_trade(self, market_slug: str) -> bool:
    # No limits - allow unlimited trading
    return True
```

**Recommendation**: Implement daily P&L tracking and auto-disable.

### 5. **Latency Concerns** ðŸŸ¡

Each trading cycle involves:
1. Price fetch from WebSocket
2. Market cache check/refresh
3. Position sync from API
4. Order book fetch (2 tokens)
5. OHLCV fetch (1m, 5m, 1h candles)
6. 8 amplification calculations
7. Pre-order recheck
8. Order execution

**Recommendation**: Profile the main loop to identify bottlenecks.

---

## 7. Recommendations

### Immediate (High Priority)

1. **Add daily loss limits**
   ```python
   # In can_trade():
   if self.daily_pnl <= Config.STOP_LOSS_THRESHOLD:
       print("[STOP] Daily loss limit reached")
       return False
   ```

2. **Reduce amplification complexity**
   - Disable or reduce weight of underperforming strategies
   - Consider reducing the 2x amplification multiplier to 1.5x

3. **Add execution metrics logging**
   - Track fill rates, slippage, and order latency
   - Log WebSocket vs REST fallback frequency

### Medium Priority

4. **Backtest individual strategies**
   - Isolate each amplification strategy's contribution
   - Calculate Sharpe ratio per strategy

5. **Add circuit breakers**
   ```python
   if consecutive_losses >= 3:
       cooldown_minutes = 10
   ```

6. **Improve parameter documentation**
   - Add comments explaining why each parameter value was chosen
   - Reference backtesting results

### Long-Term

7. **Consider simpler strategies**
   - Fair value + spread (simple market-making)
   - Single momentum indicator (reduce signal noise)

8. **Add real-time P&L dashboard**
   - WebSocket-based position tracking
   - Live P&L calculations

---

## 8. Summary Table

| Category | Rating | Notes |
|----------|--------|-------|
| **Overall Architecture** | â˜…â˜…â˜…â˜…â˜† | Clean, modular, well-organized |
| **Entry Logic** | â˜…â˜…â˜…â˜…â˜† | Good filters, but complex |
| **Exit Logic** | â˜…â˜…â˜…â˜…â˜… | Comprehensive, multiple tiers |
| **Risk Management** | â˜…â˜…â˜…â˜†â˜† | Good features, but gaps in daily limits |
| **Amplification Strategies** | â˜…â˜…â˜…â˜†â˜† | Too many, potential over-complexity |
| **Execution** | â˜…â˜…â˜…â˜…â˜† | WebSocket-based, good latency |
| **Test Mode** | â˜…â˜…â˜…â˜…â˜… | Full simulation capability |
| **Documentation** | â˜…â˜…â˜…â˜†â˜† | Parameter rationale unclear |

---

## 9. Conclusion

This is a **well-engineered trading bot** with sophisticated features. However, the complexity introduces risks:

- **Pros**: Multiple fallbacks, comprehensive exit logic, good caching
- **Cons**: Over-parameterized, no daily loss limits, amplification may be too aggressive

**Before live trading with real capital**, I recommend:
1. Extensive backtesting with historical Polymarket data
2. Paper trading in test mode for at least 2-4 weeks
3. Starting with minimal capital (e.g., $20-50) to validate execution quality
4. Implementing daily loss limits as a safety net

The foundation is solidâ€”with targeted simplifications and additional safety controls, this could be a viable trading system.
